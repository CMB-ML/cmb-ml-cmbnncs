# This patches over pipes_on_sims so that CMB-ML knows where to look
#   as it processes the downgraded Planck dataset.
# Some directories needed are "source only;" no data will be written.
# The following directory structure is assumed.
# ...root/Datasets
#   - Planck as dataset "Planck Dir" (source only)
#   - Dataset used for training
#       - Working directory for training "Training Dir" (source only)
#       - Output when using Planck as dataset with trained model

preprocess_maps:
  assets_in:
    # Pull maps from Planck Dir
    cmb_map:
      dataset: ${planck_ds}
    obs_maps:
      dataset: ${planck_ds}
    # Pull processing parameters from Training Dir
    lut:
      working: ${trained_wd}
    dataset_stats:
      working: ${trained_wd}
  dir_name: D_Prep_Observs_Planck
  # There is only the "Test" split
  splits: &test_only
    - test

preprocess_spectra:
  assets_in:
    cmb_ps:
      dataset: ${planck_ds}
  dir_name: E_Prep_Spectra_Planck 
  splits: *test_only

predict: &final_inference
  assets_in:
    model:
      working: ${trained_wd}
  splits: *test_only

show_predictions:
  assets_out:
    fig:
      # Change file name
      path_template: "{root}/{dataset}/{working}{stage}/planck_predictions_{epoch}.{fig_type}"
  assets_in:
    ps_thry:
      dataset: ${planck_ds}

ps_analysis:
  dir_name: Analysis_H_PS_Report_Planck
